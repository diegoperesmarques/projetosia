<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Código Universal</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- bwip-js for barcode generation -->
    <script src="https://cdn.jsdelivr.net/npm/bwip-js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* Applying the Inter font to the body */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>

    <script>
        // Customizing Tailwind CSS for dark mode and fonts
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <!-- Main application container -->
    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-2xl min-h-screen flex flex-col justify-center">
        
        <!-- Header section with title and theme toggle -->
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-2xl sm:text-3xl font-bold text-blue-600 dark:text-blue-400">Gerador de Código</h1>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900" aria-label="Alternar tema">
                <i class="fas fa-sun text-xl text-yellow-500"></i>
                <i class="fas fa-moon text-xl text-blue-300 hidden"></i>
            </button>
        </header>

        <!-- Main content card -->
        <main class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
            
            <!-- Input Section -->
            <div class="space-y-4">
                <div>
                    <label for="content" class="block text-sm font-medium mb-1">Conteúdo</label>
                    <textarea id="content" rows="4" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Digite o texto ou dados aqui..."></textarea>
                </div>
                <div>
                    <label for="code-type" class="block text-sm font-medium mb-1">Tipo de Código</label>
                    <select id="code-type" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="qrcode">QR Code</option>
                        <option value="datamatrix">Data Matrix</option>
                        <option value="ean13">Código de Barras (EAN-13)</option>
                        <option value="code128">Código de Barras (Code 128)</option>
                    </select>
                </div>
                <!-- Error message placeholder -->
                <p id="error-message" class="text-red-500 text-sm h-5 font-medium"></p>
            </div>

            <!-- Action Buttons -->
            <div class="mt-6">
                <button id="generate-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800">
                    Gerar Código
                </button>
            </div>

            <!-- Output Section for the generated code -->
            <div id="output" class="mt-8 flex flex-col items-center justify-center p-4 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[200px] transition">
                <p class="text-gray-500 dark:text-gray-400 text-center">A imagem do código gerado aparecerá aqui.</p>
            </div>

            <!-- Save Button (initially hidden) -->
            <div class="mt-6">
                 <button id="save-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800 hidden">
                    <i class="fas fa-download mr-2"></i>Salvar como PNG
                </button>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element Selection ---
            const themeToggle = document.getElementById('theme-toggle');
            const contentInput = document.getElementById('content');
            const codeTypeSelect = document.getElementById('code-type');
            const generateBtn = document.getElementById('generate-btn');
            const saveBtn = document.getElementById('save-btn');
            const outputDiv = document.getElementById('output');
            const errorMessage = document.getElementById('error-message');
            const sunIcon = themeToggle.querySelector('.fa-sun');
            const moonIcon = themeToggle.querySelector('.fa-moon');

            // --- Theme Management ---
            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                }
            };

            // Check for saved theme in localStorage on page load
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);

            // Event listener for theme toggle button
            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                const newTheme = isDark ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });

            // --- Input Validation ---
            function validateInput(content, type) {
                if (!content.trim()) {
                    return { valid: false, message: 'O campo de conteúdo não pode estar vazio.' };
                }

                if (type === 'ean13') {
                    // EAN-13 must be 12 or 13 digits. The library calculates the checksum if 12 are provided.
                    if (!/^\d{12,13}$/.test(content)) {
                        return { valid: false, message: 'EAN-13 deve conter 12 ou 13 dígitos numéricos.' };
                    }
                }
                // For other types, a non-empty check is sufficient for this app.
                return { valid: true, message: '' };
            }

            // --- Code Generation ---
            generateBtn.addEventListener('click', () => {
                const content = contentInput.value;
                const type = codeTypeSelect.value;

                // Clear previous state
                errorMessage.textContent = '';
                outputDiv.innerHTML = '';
                saveBtn.classList.add('hidden');

                // Validate input before proceeding
                const validation = validateInput(content, type);
                if (!validation.valid) {
                    errorMessage.textContent = validation.message;
                    outputDiv.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center">A imagem do código gerado aparecerá aqui.</p>';
                    return;
                }

                // Create a canvas element to draw the code on
                const canvas = document.createElement('canvas');
                
                // Set options for the bwip-js library
                let options = {
                    bcid: type,         // Barcode type (e.g., 'qrcode', 'ean13')
                    text: content,      // Text to encode
                    scale: 3,           // 3x scaling factor for clarity
                    height: 10,         // Bar-code height in millimeters
                    includetext: true,  // Show human-readable text below the bars
                    textxalign: 'center', // Center the text
                    backgroundcolor: 'ffffff', // Explicitly set white background
                };

                // Adjust options for 2D codes (QR Code, Data Matrix)
                if (type === 'qrcode' || type === 'datamatrix') {
                    options.height = 25; // Make square codes larger
                    options.width = 25;
                    delete options.includetext; // Text is not typically shown inside 2D codes
                }

                try {
                    // Use bwip-js to draw the barcode onto the canvas
                    bwipjs.toCanvas(canvas, options);
                    
                    // Display the generated canvas
                    outputDiv.appendChild(canvas);
                    
                    // Show the save button
                    saveBtn.classList.remove('hidden');

                } catch (e) {
                    // Catch any errors from the library (e.g., bad EAN-13 checksum)
                    console.error(e);
                    const userMessage = e.message || String(e);
                    errorMessage.textContent = `Erro: ${userMessage}. Verifique o conteúdo.`;
                    outputDiv.innerHTML = '<p class="text-red-400 text-center">Ocorreu um erro ao gerar o código.</p>';
                }
            });

            // --- Save as PNG ---
            saveBtn.addEventListener('click', () => {
                const canvas = outputDiv.querySelector('canvas');
                if (!canvas) return;

                const type = codeTypeSelect.value;
                const link = document.createElement('a');
                // Create a filename like "qrcode-1678886400000.png"
                link.download = `${type}-${Date.now()}.png`;
                // Convert canvas to a PNG image data URL
                link.href = canvas.toDataURL('image/png');
                // Trigger the download
                link.click();
            });
        });
    </script>

</body>
</html>
